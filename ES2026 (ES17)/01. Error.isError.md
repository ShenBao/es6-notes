# Error.isError

proposal-is-error 提案旨在为 JavaScript 引入一种新的方法 Error.isError，用于可靠地判断一个值是否为原生 Error 对象。这将解决 instanceof Error 在跨上下文（如 iframe 或 Node.js 的 vm 模块）使用时可能导致的误判问题。

当前，判断一个对象是否为 Error 实例主要依赖于 instanceof Error，但这种方法在跨越不同环境时并不可靠。不同 JavaScript 运行环境之间创建的错误对象实例无法通过 instanceof 进行可靠的验证。此外，Symbol.toStringTag 也影响了通过 Object.prototype.toString 进行检验的可靠性。

- 调试：在调试过程中，能确定一个值是否为原生错误，这对错误报告库非常有益。
- 序列化：平台如 RunKit 需要安全地序列化值并在用户浏览器中重建或描述它们，品牌检查对此至关重要。
- 结构化克隆：HTML 的 structuredClone 方法以及 Node.js 中的克隆方法对原生错误对象有特殊处理。JavaScript 程序需要一种方法来提前知道这种行为是否会被应用。

语法：

```js
Error.isError(value);
```

返回值：true 如果 value 是 Error；否则，false。

基本用法：

```js
class CustomError extends Error {}

const error = new Error("This is an error");
const customError = new CustomError("This is a custom error");
const notAnError = {};

console.log(Error.isError(error)); // 输出: true
console.log(Error.isError(customError)); // 输出: true
console.log(Error.isError(notAnError)); // 输出: false
console.log(Error.isError(undefined)); // 输出: false
```

处理跨域实例：

```js
// 假设我们有一个 iframe 引入的页面
const iframe = document.createElement("iframe");
document.body.appendChild(iframe);

const iframeError = iframe.contentWindow.Error(
  "This error comes from an iframe"
);

console.log(Error.isError(iframeError)); // 输出: true
console.log(iframeError instanceof Error); // 输出: false
```

## Links

- https://github.com/tc39/proposal-is-error
- https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error/isError
- https://tc39.es/ecma262/multipage/fundamental-objects.html#sec-error.iserror
