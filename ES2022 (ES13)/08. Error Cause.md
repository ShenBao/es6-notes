# Error Cause

ğŸ‰ Error cause æ˜¯ç¬¬ä¸€ä¸ªç”±ä¸­å›½å…¬å¸ï¼ˆé˜¿é‡Œå·´å·´ TC39 ä»£è¡¨ legendecasï¼‰ä»£è¡¨ä¸»å¯¼æ¨åŠ¨çš„ JavaScript è¾¾åˆ° stage 4 çš„æ–°ç‰¹æ€§ææ¡ˆï¼

è¿™ä¸ªææ¡ˆç®€å•ç†è§£å°±æ˜¯ï¼šå¯¹ Error çš„æ¥æºè¿›è¡Œä¸€æ¬¡å†åŒ…è£…ï¼›

ä¾‹å­ï¼š

```js
async function getSolution() {
  const rawResource = await fetch('//domain/resource-a')
    .catch(err => {
      // å¹³æ—¶æˆ‘ä»¬è¦æŠ›å‡ºé”™è¯¯æœ‰ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š
      // 1. throw new Error('Download raw resource failed: ' + err.message);
      // 2. const wrapErr = new Error('Download raw resource failed');
      //    wrapErr.cause = err;
      //    throw wrapErr;
      // 3. class CustomError extends Error {
      //      constructor(msg, cause) {
      //        super(msg);
      //        this.cause = cause;
      //      }
      //    }
      //    throw new CustomError('Download raw resource failed', err);
    })
  const jobResult = doComputationalHeavyJob(rawResource);
  await fetch('//domain/upload', { method: 'POST', body: jobResult });
}

await doJob(); // => TypeError: Failed to fetch
```

åœ¨æ–°çš„ææ¡ˆä¸­ï¼ŒåŠ å…¥äº† cause æ¥æ”¶é›†åŸå› ï¼Œè§„èŒƒåŒ–æ•´ä¸ªé”™è¯¯æŠ›å‡ºå’Œæ”¶é›†ï¼š

Error Constructor æ–°å¢äº†ä¸€ä¸ªå¯é€‰çš„å‚æ•° optionsï¼Œå…¶ä¸­å¯ä»¥è®¾ç½® cause å¹¶ä¸”æ¥å—ä»»æ„ JavaScript å€¼ï¼ŒæŠŠè¿™ä¸ªå€¼èµ‹å€¼åˆ°æ–°åˆ›å»ºçš„ error.cause ä¸Šã€‚

```js
async function doJob() {
  const rawResource = await fetch('//domain/resource-a')
    .catch(err => {
      // æŠ›å‡ºä¸€ä¸ªä½ç­‰çº§é”™è¯¯errï¼Œå¯ä»¥é€šè¿‡ cause åŒ…è£…æˆé«˜ç­‰çº§é”™è¯¯ Error
      throw new Error('Download raw resource failed', { cause: err });
    });
  const jobResult = doComputationalHeavyJob(rawResource);
  await fetch('//domain/upload', { method: 'POST', body: jobResult })
    .catch(err => {
      throw new Error('Upload job result failed', { cause: err });
    });
}

try {
  await doJob();
} catch (e) {
  console.log(e);
  console.log('Caused by', e.cause);
}
// Error: Upload job result failed
// Caused by TypeError: Failed to fetch
```

æœ‰äº†è¿™ä¸ªåï¼Œå„ç§æ’ä»¶åº“çš„å½¢å½¢è‰²è‰²çš„é”™è¯¯ç±»å¯ä»¥ç®€å•ç‚¹äº†ã€‚
